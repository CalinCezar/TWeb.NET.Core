@model Forums.Web.Models.UserData
@{
    ViewData["Title"] = "Profile";
    Layout = null;
}

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<link href="~/css/profile.css" rel="stylesheet" />
<title>#BlogHub</title>
<link rel="icon" type="image/x-icon" href="~/images/icon.png" />

<div class="container emp-profile">
    @Html.ValidationSummary(true, "", new { @class = "text-red" })
    <form id="edit" asp-action="Index" asp-controller="Profile" method="post">
        @Html.AntiForgeryToken()

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">
                @TempData["SuccessMessage"]
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            </div>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">
                @TempData["ErrorMessage"]
            </div>
        }

        <div class="row">
            <!-- Profile Image -->
            <div class="col-md-4">
                <div class="profile-img">
                    @if (string.IsNullOrEmpty(Model.Photo))
                    {
                        <img id="profile-img" src="~/images/icon_profile.png" />
                    }
                    else
                    {
                        <img id="profile-img" src="@Url.Content(Model.Photo)" />
                    }
                    <div class="file btn btn-lg btn-primary">
                        <input type="file" id="PhotoInput" name="Photo" />
                        Change Photo
                    </div>
                </div>

                <script>
                    $(document).ready(function () {
                        $('#PhotoInput').change(function () {
                            var formData = new FormData();
                            formData.append('Photo', $('#PhotoInput')[0].files[0]);

                            $.ajax({
                                url: '@Url.Action("UploadPhoto", "Profile")',
                                type: 'POST',
                                data: formData,
                                processData: false,
                                contentType: false,
                                success: function (response) {
                                    if (response.status) {
                                        $('#profile-img').attr('src', response.photoUrl);
                                    } else {
                                        alert('Error uploading image.');
                                    }
                                },
                                error: function () {
                                    alert('Error communicating with the server.');
                                }
                            });
                        });
                    });
                </script>
            </div>

            <!-- Profile Details -->
            <div class="col-md-6">
                <div class="profile-head">
                    <h5>@Html.DisplayFor(u => u.Username)</h5>
                    <h6>@Html.DisplayFor(u => u.Profession)</h6>

                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Timeline</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="col-md-2">
                <input type="submit" class="profile-edit-btn" name="btnHome" value="Home" formaction="@Url.Action("HomePage", "Home")" />
                <input type="submit" class="profile-edit-btn" name="btnLogOut" value="Log Out" formaction="@Url.Action("Logout", "Profile")" />
                <input type="submit" class="profile-edit-btn" formaction="@Url.Action("EditProfile", "Profile")" value="Edit Profile" />
                <input type="submit" class="confirm_del_btn profile-edit-btn" id="deleteUserBtn" formaction="@Url.Action("DeleteUser", "Profile")" value="Delete" />
            </div>
        </div>

        <!-- Profile Content -->
        <div class="row">
            <div class="col-md-4">
                <!-- Profile Work/Statistics (if needed) -->
            </div>

            <div class="col-md-8">
                <div class="tab-content profile-tab" id="myTabContent">
                    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                        <!-- Profile About Section -->
                        <!-- Input fields for Fullname, Email, Phone, Profession, InfoBlog -->
                    </div>
                    <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                        <!-- Profile Timeline Section -->
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script src="~/assets/js/edit-profile.js"></script>
